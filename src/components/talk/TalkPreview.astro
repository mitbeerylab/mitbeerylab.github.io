---
import { getTalkSortDate, type TalkEntry } from "@/data/talk";
import type { HTMLTag, Polymorphic } from "astro/types";
import { Icon } from "astro-icon/components";

import FormattedDate from "../FormattedDate.astro";

type Props<Tag extends HTMLTag> = {
	talk: TalkEntry;
	withDesc?: boolean;
} & Polymorphic<{ as: Tag }>;

const { as: Tag = "div", talk, withDesc = false } = Astro.props;
const talkDate = getTalkSortDate(talk);
const hasExternal = Boolean(talk.data.external);
---
<Tag class="flex flex-row items-start">
	<!-- <a href={talk.data.external}>{parseYoutubeID(talk.data.external) && <img alt="" src={`https://img.youtube.com/vi/${parseYoutubeID(talk.data.external)}/default.jpg`} />}</a> -->
	<FormattedDate class="min-w-[120px] text-gray-600 dark:text-gray-400 leading-7" date={talkDate} />
	<div class="flex-1">
		{talk.data.draft && <span class="text-red-500">(Draft) </span>}
		<div>
			{hasExternal ? (
				<a class="cactus-link text-xl font-bold" href={talk.data.external}>
					{talk.data.title}
					<Icon aria-hidden="true" class="inline mx-1 h-4 w-4" focusable="false" name="mdi:external-link" />
				</a>
			) : (
				<span class="text-xl font-bold">{talk.data.title}</span>
			)}
			<p class="mt-2">{talk.data.speaker}</p>
			<p class="text-gray-500">{talk.data.host}</p>
		</div>
		{withDesc && <q class="line-clamp-3 italic">{talk.data.description}</q>}
	</div>
</Tag>
